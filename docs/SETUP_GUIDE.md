# セットアップガイド

KoeMoji-Go Webの録音機能を使用するための、システムオーディオとマイクの同時録音セットアップ方法を説明します。

## 📋 目次

- [なぜセットアップが必要か](#なぜセットアップが必要か)
- [macOS: BlackHoleセットアップ](#macos-blackholeセットアップ)
- [Windows: VoiceMeeterセットアップ](#windows-voicemeeterセットアップ)
- [Chrome拡張での設定](#chrome拡張での設定)
- [トラブルシューティング](#トラブルシューティング)

## なぜセットアップが必要か

Web会議の完全な録音（自分の声 + 他の参加者の声）には、以下の音声を同時にキャプチャする必要があります:

- **マイク入力** - あなたの声
- **システム音声** - 他の参加者の声（ブラウザから再生される音）

通常のブラウザ設定では、この2つを同時に録音できません。そのため、**仮想オーディオデバイス**を使ってこれらをミックスする必要があります。

### セットアップは一度だけ

初回のセットアップは10-15分程度かかりますが、**一度設定すれば以降は自動的に動作**します。

## macOS: BlackHoleセットアップ

macOSでは、BlackHoleという仮想オーディオデバイスを使用します。

### Step 1: BlackHoleのインストール

#### 方法1: Homebrewを使用（推奨）

```bash
# Homebrewがない場合は先にインストール
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# BlackHoleをインストール
brew install blackhole-2ch
```

#### 方法2: 手動インストール

1. [BlackHole公式サイト](https://existential.audio/blackhole/)にアクセス
2. **BlackHole 2ch**をダウンロード
3. `BlackHole2ch.pkg`を実行してインストール
4. システムを再起動（推奨）

### Step 2: 集約デバイスの作成

1. **Audio MIDI設定を開く**
   - Finder → アプリケーション → ユーティリティ → Audio MIDI設定
   - または Spotlight検索で「Audio MIDI」と入力

2. **集約デバイスを作成**
   - 左下の「+」ボタンをクリック
   - 「集約デバイスを作成」を選択

3. **デバイスに名前をつける**
   - 作成されたデバイスをダブルクリック
   - 名前を「KoeMoji集約デバイス」等に変更

4. **デバイスを選択**

   必ず以下の順序で選択してください:

   - ✅ **内蔵マイク**（または使用するマイク）← **最初に配置**
   - ✅ **BlackHole 2ch**

   **重要**: マイクを上側（最初）に配置することで、正しい音声が録音されます。

5. **サンプリングレートを確認**
   - 右側の設定で「44100.0 Hz」に統一されているか確認

### Step 3: マルチ出力デバイスの作成（音を聞きながら録音する場合）

録音中も音を聞きたい場合は、マルチ出力デバイスを作成します。

1. **マルチ出力デバイスを作成**
   - Audio MIDI設定で左下の「+」をクリック
   - 「マルチ出力デバイスを作成」を選択

2. **出力デバイスを選択**
   - ✅ **内蔵スピーカー**（またはヘッドホン）
   - ✅ **BlackHole 2ch**

3. **マスターデバイスを設定**
   - 内蔵スピーカーの左側にある「⚙️」アイコンをクリック
   - 「このデバイスをマスタークロックソースとして使用」にチェック

### Step 4: システム出力の変更

録音時は、システムの音声出力先を変更します。

1. **システム環境設定を開く**
   - アップルメニュー → システム環境設定 → サウンド

2. **出力タブを選択**
   - 「マルチ出力デバイス」を選択（作成した場合）
   - または「BlackHole 2ch」を選択（音は聞こえなくなります）

### 完了！

これでmacOSでのセットアップは完了です。Chrome拡張の設定に進んでください。

---

## Windows: VoiceMeeterセットアップ

Windowsでは、VoiceMeeterという無料の仮想オーディオミキサーを使用します。

### Step 1: VoiceMeeterのインストール

1. **VoiceMeeter公式サイトにアクセス**
   - [https://vb-audio.com/Voicemeeter/](https://vb-audio.com/Voicemeeter/)

2. **VoiceMeeter Basic（無料版）をダウンロード**
   - 「Download」ボタンをクリック
   - `VoicemeeterSetup.zip`をダウンロード

3. **インストール**
   - ZIPファイルを展開
   - `VoicemeeterSetup.exe`を右クリック → 「管理者として実行」
   - インストールウィザードに従ってインストール

4. **システムを再起動**
   - **重要**: 再起動しないとデバイスが正しく認識されません

### Step 2: VoiceMeeterの基本設定

1. **VoiceMeeterを起動**
   - スタートメニュー → VoiceMeeter → VoiceMeeter

2. **Hardware Input 1（マイク）を設定**
   - 「HARDWARE INPUT 1」の右上のデバイス選択
   - 使用するマイクを選択（例: "WDM: マイク配列"）

3. **Hardware Input 2（システム音）を設定**
   - 「HARDWARE INPUT 2」の右上のデバイス選択
   - **「WDM: スピーカー (Realtek Audio)」等を選択**
   - または「WDM: ヘッドホン」など、普段使用しているスピーカー

4. **A1出力（スピーカー）を設定**
   - 右上の「A1」セクション
   - 実際のスピーカー/ヘッドホンを選択

### Step 3: 入力のルーティング設定

各入力（マイク・システム音）を出力先に送信します。

#### Hardware Input 1（マイク）
- **A1**: ONにする（スピーカーから聞こえるように）
- **B1**: ONにする（VoiceMeeter Outputに送信）

#### Hardware Input 2（システム音）
- **A1**: ONにする（スピーカーから聞こえるように）
- **B1**: ONにする（VoiceMeeter Outputに送信）

### Step 4: Windowsサウンド設定

1. **Windowsの設定を開く**
   - スタートメニュー → 設定 → システム → サウンド

2. **出力デバイスを変更**
   - 「出力デバイスを選択してください」で以下を選択:
   - **「VoiceMeeter Input (VB-Audio VoiceMeeter VAIO)」**

3. **確認**
   - YouTubeなどで音楽を再生
   - VoiceMeeterの「Hardware Input 2」のレベルメーターが動くか確認

### Step 5: 音量調整（オプション）

VoiceMeeterで各入力の音量を調整できます。

- **マイク音量**: Hardware Input 1のフェーダー（縦のスライダー）
- **システム音量**: Hardware Input 2のフェーダー
- **全体音量**: Master Sectionのフェーダー

### 完了！

これでWindowsでのセットアップは完了です。Chrome拡張の設定に進んでください。

---

## Chrome拡張での設定

macOSまたはWindowsのセットアップが完了したら、Chrome拡張で録音デバイスを設定します。

### Step 1: Chrome拡張のインストール

1. Chrome拡張機能ページを開く
   - アドレスバーに `chrome://extensions/` と入力

2. デベロッパーモードを有効化
   - 右上の「デベロッパーモード」トグルをON

3. 拡張機能を読み込む
   - 「パッケージ化されていない拡張機能を読み込む」をクリック
   - `koemoji-web` フォルダを選択

### Step 2: 録音デバイスの設定

1. **拡張機能アイコンをクリック**
   - Chromeツールバーの🎙️アイコンをクリック

2. **設定画面を開く**
   - ポップアップ下部の「⚙️ Settings」をクリック

3. **録音デバイスを選択**

   **macOS:**
   - 「Recording Device」で「KoeMoji集約デバイス」を選択

   **Windows:**
   - 「Recording Device」で「VoiceMeeter Output」を選択

4. **OpenAI APIキーを設定**
   - 「OpenAI API Key」欄にAPIキーを入力
   - [APIキー取得方法](https://platform.openai.com/api-keys)

5. **設定を保存**
   - 「Save Settings」をクリック

### Step 3: 動作確認

1. **Google Meetでテスト**
   - Google Meetで新しい会議を作成
   - 一人で会議に参加

2. **録音開始**
   - Chrome拡張アイコンをクリック
   - 「🔴 Start Recording」をクリック

3. **マイクテスト**
   - 何か話してみる
   - 録音中のインジケーターが表示される

4. **録音停止**
   - 「⏹️ Stop & Transcribe」をクリック
   - 文字起こし処理が開始される

5. **結果確認**
   - 自分の声が正しく文字起こしされているか確認

### 完了！

すべて正常に動作すれば、セットアップは完了です。

---

## トラブルシューティング

### 録音ができない

#### macOS

**症状**: 録音ボタンを押してもエラーになる

**解決策**:
1. **マイク権限を確認**
   - システム環境設定 → セキュリティとプライバシー → プライバシー → マイク
   - Google Chromeにチェックが入っているか確認

2. **集約デバイスを確認**
   - Audio MIDI設定で集約デバイスが存在するか確認
   - マイクとBlackHoleの順序を確認（マイクが上）

3. **Chromeを再起動**
   - Chromeを完全終了して再起動

#### Windows

**症状**: 録音ボタンを押してもエラーになる

**解決策**:
1. **VoiceMeeterが起動しているか確認**
   - タスクバーにVoiceMeeterのアイコンがあるか確認

2. **デバイスを確認**
   - Windowsのサウンド設定
   - 「VoiceMeeter Output」が録音デバイスとして有効か確認

3. **VoiceMeeterを再起動**
   - VoiceMeeterを終了して再起動

### 自分の声が録音されない

#### macOS

**原因**: 集約デバイスにマイクが含まれていない

**解決策**:
1. Audio MIDI設定を開く
2. 集約デバイスを選択
3. マイクにチェックが入っているか確認
4. マイクが上側（最初）にあるか確認

#### Windows

**原因**: VoiceMeeterでマイク入力が無効

**解決策**:
1. VoiceMeeterを開く
2. Hardware Input 1（マイク）のB1がONになっているか確認
3. マイクのフェーダーが0になっていないか確認

### システム音声が録音されない

#### macOS

**原因**: システム出力がBlackHoleになっていない

**解決策**:
1. システム環境設定 → サウンド → 出力
2. 「BlackHole 2ch」または「マルチ出力デバイス」を選択
3. 会議中に音が聞こえることを確認

#### Windows

**原因**: システム音がVoiceMeeterに送られていない

**解決策**:
1. Windowsのサウンド設定
2. 出力デバイスが「VoiceMeeter Input」になっているか確認
3. YouTubeで音楽を再生して、VoiceMeeterのレベルメーターが動くか確認

### 録音中に音が聞こえない

#### macOS

**原因**: システム出力がBlackHoleのみになっている

**解決策**:
1. マルチ出力デバイスを作成（上記の手順参照）
2. システム出力をマルチ出力デバイスに変更

#### Windows

**原因**: VoiceMeeterのA1出力が無効

**解決策**:
1. VoiceMeeterでHardware Input 1, 2のA1をONにする
2. A1出力デバイスが正しいスピーカーに設定されているか確認

### 文字起こしが失敗する

**原因**: OpenAI APIキーの問題

**解決策**:
1. 設定画面でAPIキーを再確認
2. [OpenAI Platform](https://platform.openai.com/)でAPIキーの利用制限を確認
3. APIキーに十分な残高があるか確認

### 録音品質が悪い

**原因**: マイク音量が小さい、またはノイズが多い

**解決策（macOS）**:
1. Audio MIDI設定で集約デバイスの入力レベルを確認
2. システム環境設定 → サウンド → 入力でマイク音量を調整

**解決策（Windows）**:
1. VoiceMeeterでマイク入力のフェーダーを調整
2. マイクの「COMP」ボタンで音量を安定化

---

## 高度な設定

### 自動起動設定（Windows）

VoiceMeeterを自動起動するように設定できます。

1. VoiceMeeterのショートカットを作成
2. `shell:startup` フォルダに配置
3. 次回起動時から自動起動

### プロファイル保存（macOS）

複数の集約デバイスを作成して、シナリオに応じて切り替えることができます。

例:
- 「会議用集約デバイス」- マイク + BlackHole
- 「プレゼン用集約デバイス」- システム音のみ

---

## 📞 サポート

問題が解決しない場合は、以下の情報と共にお問い合わせください:

1. OS種別とバージョン
2. 使用している仮想オーディオデバイス（BlackHole/VoiceMeeter）
3. エラーメッセージ（あれば）
4. 録音デバイス一覧のスクリーンショット

連絡先: koemoji2024@gmail.com
